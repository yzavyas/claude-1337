---
// DirectoryNav.astro - dynamically generates navigation from directory contents
const { path } = Astro.props;

// Get all .astro files in the directory
const allPages = await Astro.glob('../pages/**/*.astro');

// Filter to just the pages in our target directory (excluding index)
const pages = allPages
  .filter(page => {
    const relativePath = page.file.split('/pages/')[1];
    const parts = relativePath.split('/');

    // For top-level like "explanation", match explanation/*.astro (not index)
    // For nested like "reference/research", match reference/research/*.astro (not index)
    const pathParts = path.split('/');
    const fileName = parts[parts.length - 1];

    if (pathParts.length === 1) {
      // Top-level: explanation/*.astro
      return parts.length === 2 && parts[0] === pathParts[0] && fileName !== 'index.astro';
    } else {
      // Nested: reference/research/*.astro
      return parts.length === 3 &&
             parts[0] === pathParts[0] &&
             parts[1] === pathParts[1] &&
             fileName !== 'index.astro';
    }
  })
  .map(page => {
    const fileName = page.file.split('/').pop().replace('.astro', '');
    return {
      slug: fileName,
      title: page.frontmatter?.title || fileName,
      description: page.frontmatter?.description || ''
    };
  })
  .sort((a, b) => a.title.localeCompare(b.title));
---

<nav class="directory-nav">
  {pages.length === 0 ? (
    <p class="no-pages">no pages in this section yet</p>
  ) : (
    <div class="nav-grid">
      {pages.map(page => (
        <a href={`/claude-1337/${path}/${page.slug}/`} class="nav-card">
          <h3>{page.title}</h3>
          {page.description && <p class="description">{page.description}</p>}
          <span class="arrow">â†’</span>
        </a>
      ))}
    </div>
  )}
</nav>

<style>
  .directory-nav {
    margin: 2rem 0;
  }

  .nav-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 1rem;
  }

  .nav-card {
    display: block;
    padding: 1.25rem;
    background: var(--bg-alt);
    border: 1px solid var(--fg-dim);
    border-radius: 6px;
    text-decoration: none;
    transition: all 0.2s;
    position: relative;
    overflow: hidden;
  }

  .nav-card:hover {
    border-color: var(--green);
    background: rgba(34, 34, 34, 0.8);
    box-shadow: 0 0 16px rgba(158, 206, 106, 0.2);
    transform: translateY(-2px);
  }

  .nav-card h3 {
    margin: 0 0 0.5rem 0;
    font-size: 1rem;
    font-weight: bold;
    color: var(--fg);
    transition: color 0.2s;
  }

  .nav-card:hover h3 {
    color: var(--green);
    text-shadow: 0 0 8px rgba(158, 206, 106, 0.5);
  }

  .nav-card .description {
    margin: 0;
    font-size: 0.85rem;
    color: var(--fg-dim);
    line-height: 1.4;
  }

  .nav-card .arrow {
    position: absolute;
    right: 1.25rem;
    top: 1.25rem;
    font-size: 1.25rem;
    color: var(--fg-dim);
    transition: all 0.2s;
  }

  .nav-card:hover .arrow {
    color: var(--green);
    transform: translateX(4px);
    text-shadow: 0 0 8px rgba(158, 206, 106, 0.6);
  }

  .no-pages {
    text-align: center;
    color: var(--fg-dim);
    font-style: italic;
    padding: 2rem;
  }

  /* Single column on mobile */
  @media (max-width: 640px) {
    .nav-grid {
      grid-template-columns: 1fr;
    }
  }
</style>
